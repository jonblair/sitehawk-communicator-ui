{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _classCallCheck from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\jblair\\\\Desktop\\\\React\\\\sitehawk-communicator-ui\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from\"react\";import\"../login-form/login-form.css\";import\"moment/moment\";import{withRouter}from'react-router-dom';var LoginForm=/*#__PURE__*/function(_React$Component){_inherits(LoginForm,_React$Component);function LoginForm(props){var _this;_classCallCheck(this,LoginForm);_this=_possibleConstructorReturn(this,_getPrototypeOf(LoginForm).call(this,props));_this.handleChange=function(_ref){var target=_ref.target;_this.setState(_defineProperty({},target.name,target.value));};_this.state={username:'',password:'',corporationid:'',errorMessage:''};_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_this));_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));return _this;}_createClass(LoginForm,[{key:\"handleSubmit\",value:function(){var _handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return this.login(this.state.username,this.state.password,this.state.corporationid);case 3:case\"end\":return _context.stop();}}},_callee,this);}));function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}return handleSubmit;}()},{key:\"login\",value:function(){var _login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(myUsername,myPassword,myCorporationId){var _this2=this;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return fetch('/api/v1/Authorize',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:myUsername,password:myPassword,corporationId:myCorporationId})}).then(function(response){return response.json();}).then(function(data){localStorage.setItem('token',data.accessToken);_this2.getUserIdAndCorpIdFomJwtToken(data.accessToken);_this2.getUserData(localStorage.getItem('userid'));}).catch(function(error){console.error('Error:',error);_this2.setState({errorMessage:'Login failed'});});case 2:case\"end\":return _context2.stop();}}},_callee2);}));function login(_x2,_x3,_x4){return _login.apply(this,arguments);}return login;}()},{key:\"getUserData\",value:function(){var _getUserData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userId){var _this3=this;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetch(\"/api/v1/User/\".concat(userId),{method:'GET',headers:{'Authorization':'Bearer '+localStorage.getItem('token'),'Content-Type':'application/json'}}).then(function(response){return response.json();}).then(function(data){localStorage.setItem('user',JSON.stringify(data));_this3.props.history.push('/default');}).catch(function(error){console.error('Error:',error);_this3.setState({errorMessage:error.message});});case 2:case\"end\":return _context3.stop();}}},_callee3);}));function getUserData(_x5){return _getUserData.apply(this,arguments);}return getUserData;}()},{key:\"getUserIdAndCorpIdFomJwtToken\",value:function getUserIdAndCorpIdFomJwtToken(token){var jwt=require(\"jsonwebtoken\");var decode=jwt.decode(token);var ids=decode.sub.split('|');localStorage.setItem('userid',ids[0]);localStorage.setItem('corporationid',ids[1]);}},{key:\"render\",value:function render(){var _React$createElement,_React$createElement2,_React$createElement3;return React.createElement(\"div\",{className:\"wrap loginFields\"},React.createElement(\"div\",{id:\"login\"},React.createElement(\"div\",{id:\"LoginHeader\"},\"Communicator Login\"),React.createElement(React.Fragment,null,React.createElement(\"form\",{onSubmit:this.handleSubmit},React.createElement(\"div\",{className:\"loginEntry\"},React.createElement(\"input\",(_React$createElement={name:\"txtBxUserName\",type:\"text\",id:\"txtBxUserName\"},_defineProperty(_React$createElement,\"name\",\"username\"),_defineProperty(_React$createElement,\"value\",this.state.username),_defineProperty(_React$createElement,\"onChange\",this.handleChange),_defineProperty(_React$createElement,\"className\",\"textEntry\"),_defineProperty(_React$createElement,\"placeholder\",\"Login Name\"),_React$createElement)),React.createElement(\"input\",(_React$createElement2={name:\"txtBxPassword\",id:\"txtBxPassword\"},_defineProperty(_React$createElement2,\"name\",\"password\"),_defineProperty(_React$createElement2,\"value\",this.state.password),_defineProperty(_React$createElement2,\"onChange\",this.handleChange),_defineProperty(_React$createElement2,\"className\",\"textEntry\"),_defineProperty(_React$createElement2,\"type\",\"password\"),_defineProperty(_React$createElement2,\"placeholder\",\"Password\"),_React$createElement2)),React.createElement(\"input\",(_React$createElement3={name:\"txtBxCompanyId\",type:\"text\",id:\"txtBxCompanyId\"},_defineProperty(_React$createElement3,\"name\",\"corporationid\"),_defineProperty(_React$createElement3,\"value\",this.state.corporationid),_defineProperty(_React$createElement3,\"onChange\",this.handleChange),_defineProperty(_React$createElement3,\"className\",\"textEntry\"),_defineProperty(_React$createElement3,\"placeholder\",\"Company ID\"),_React$createElement3))),React.createElement(\"input\",{type:\"submit\",name:\"btnLoginButton\",value:\"Log In\",id:\"btnLoginButton\"}),this.state.errorMessage&&React.createElement(\"h3\",{className:\"error\"},\" \",this.state.errorMessage,\" \")))),React.createElement(\"br\",null),React.createElement(\"div\",{id:\"ssl\"},React.createElement(\"p\",null,\"TLS Enabled\")));}}]);return LoginForm;}(React.Component);export default withRouter(LoginForm);","map":{"version":3,"sources":["C:/Users/jblair/Desktop/React/sitehawk-communicator-ui/src/components/login-form/login-form.js"],"names":["React","withRouter","LoginForm","props","handleChange","target","setState","name","value","state","username","password","corporationid","errorMessage","bind","handleSubmit","e","preventDefault","login","myUsername","myPassword","myCorporationId","fetch","method","headers","body","JSON","stringify","corporationId","then","response","json","data","localStorage","setItem","accessToken","getUserIdAndCorpIdFomJwtToken","getUserData","getItem","catch","error","console","userId","history","push","message","token","jwt","require","decode","ids","sub","split","Component"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport \"../login-form/login-form.css\";\r\nimport \"moment/moment\";\r\nimport { withRouter } from 'react-router-dom' \r\n\r\nclass LoginForm extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { username: '', password: '', corporationid: '', errorMessage: '' };\r\n\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n  }\r\n\r\n  async handleSubmit(e) {\r\n    e.preventDefault();\r\n    await this.login(this.state.username, this.state.password, this.state.corporationid);\r\n  }\r\n\r\n  handleChange = ({ target }) => {\r\n    this.setState({ [target.name]: target.value });\r\n };\r\n\r\n  async login(myUsername, myPassword, myCorporationId) {\r\n    await fetch('/api/v1/Authorize', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({username: myUsername, password: myPassword, corporationId: myCorporationId}),\r\n    })\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      localStorage.setItem('token', data.accessToken);\r\n      this.getUserIdAndCorpIdFomJwtToken(data.accessToken);\r\n      this.getUserData(localStorage.getItem('userid'));\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error:', error);\r\n      this.setState({errorMessage: 'Login failed'});\r\n    });\r\n  }\r\n\r\n  async getUserData(userId) {\r\n    await fetch(`/api/v1/User/${userId}`, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Authorization': 'Bearer ' + localStorage.getItem('token'),\r\n        'Content-Type': 'application/json'\r\n      }\r\n    })\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      localStorage.setItem('user', JSON.stringify(data));\r\n      this.props.history.push('/default');\r\n    })\r\n    .catch((error) => {\r\n      console.error('Error:', error);\r\n      this.setState({errorMessage: error.message});\r\n    });\r\n  }\r\n\r\n  getUserIdAndCorpIdFomJwtToken(token) {\r\n    var jwt = require(\"jsonwebtoken\");\r\n    var decode = jwt.decode(token);\r\n    var ids = decode.sub.split('|');\r\n\r\n    localStorage.setItem('userid', ids[0]);\r\n    localStorage.setItem('corporationid', ids[1]);\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"wrap loginFields\">\r\n        <div id=\"login\">\r\n          <div id=\"LoginHeader\">Communicator Login</div>\r\n          <React.Fragment>\r\n            <form onSubmit={this.handleSubmit}>\r\n              <div className=\"loginEntry\">\r\n                <input name=\"txtBxUserName\" type=\"text\" id=\"txtBxUserName\" name=\"username\" value={this.state.username}\r\n                onChange={this.handleChange} className=\"textEntry\" placeholder=\"Login Name\"></input>\r\n                <input name=\"txtBxPassword\" id=\"txtBxPassword\" name=\"password\" value={this.state.password}\r\n                onChange={this.handleChange} className=\"textEntry\" type=\"password\" placeholder=\"Password\"></input>\r\n                <input name=\"txtBxCompanyId\" type=\"text\" id=\"txtBxCompanyId\" name=\"corporationid\" value={this.state.corporationid}\r\n                onChange={this.handleChange} className=\"textEntry\" placeholder=\"Company ID\"></input>\r\n              </div>\r\n              <input type=\"submit\" name=\"btnLoginButton\" value=\"Log In\" id=\"btnLoginButton\" />\r\n              {this.state.errorMessage && <h3 className=\"error\"> { this.state.errorMessage } </h3>}\r\n            </form>\r\n          </React.Fragment>\r\n        </div>\r\n        <br/>\r\n        <div id=\"ssl\">\r\n            <p>TLS Enabled</p>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n} \r\n\r\nexport default withRouter(LoginForm);"]},"metadata":{},"sourceType":"module"}